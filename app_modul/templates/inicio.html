{% extends 'base.html' %}
{% load static %} 
{% block content %}
<html>
  <head>
    <link
      rel="stylesheet"
      href="{% static 'aplicacion/css/style_dashboard.css' %}"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
      <div
        class="grafica-container custom-chart ml-3"
      >
        <canvas class="p-2" id="myChart"></canvas>

        <!-- Grafida del dashboar -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <script>
          const ctx = document.getElementById("myChart").getContext('2d');
          var kilos = JSON.parse('{{ kilos|safe }}');

        // Función para obtener el nombre del día de la semana
        function obtenerDiaSemana(fechaStr) {
            const diasSemana = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
            const fecha = new Date(fechaStr);
            return diasSemana[fecha.getDay()];
        }

        // Agrupar los pesos por día de la semana
        const pesosPorDia = kilos.reduce((acc, kilo) => {
            const diaSemana = obtenerDiaSemana(kilo.fecha);
            if (!acc[diaSemana]) {
                acc[diaSemana] = 0;
            }
            acc[diaSemana] += kilo.total_peso;
            return acc;
        }, {});

        const diasSemana = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
        const pesos = diasSemana.map(dia => pesosPorDia[dia] || 0);



                  // Generar un array de colores para cada barra
        var colors = pesos.map(function(_, index) {
            var r = Math.floor(Math.random() * 255);
            var g = Math.floor(Math.random() * 255);
            var b = Math.floor(Math.random() * 255);
            return {
                backgroundColor: `rgba(${r}, ${g}, ${b}, 0.2)`,
                borderColor: `rgba(${r}, ${g}, ${b}, 1)`
            };
        });

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: diasSemana,
              datasets: [
                {
                  label: "Resultados de Cosecha",
                  data: pesos,
                  backgroundColor: colors.map(color => color.backgroundColor),
                    borderColor: colors.map(color => color.borderColor),
                    borderWidth: 1
                },
              ],
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });

        </script>
      </div>
  </body>

  <script
    src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"
  ></script>
</html>

{% endblock %}
